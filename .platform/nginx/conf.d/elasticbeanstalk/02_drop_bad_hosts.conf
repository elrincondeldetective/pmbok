# .platform/nginx/conf.d/elasticbeanstalk/02_drop_bad_hosts.conf
# Permite solo estos hosts (sin afectar /healthz porque ahí ya forzamos Host arriba)
# .platform/nginx/conf.d/elasticbeanstalk/02_drop_bad_hosts.conf

# Solo aceptar estos hosts, pero SIEMPRE permitir /healthz
set $drop 1;

# Whitelist de hosts válidos
if ($host ~* ^(pmbok-app-prod\.eba-p9tjqp8p\.us-east-1\.elasticbeanstalk\.com|api\.elrincondeldetective\.com)$) {
    set $drop 0;
}

# Excepción para el health check
if ($request_uri = "/healthz") {
    set $drop 0;
}

# Si sigue siendo “malo”, cortar
if ($drop) {
    return 444;
}
