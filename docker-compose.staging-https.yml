# docker-compose.staging-https.yml
services:
  backend-staging:
    # No expongas el puerto del backend hacia el host en la variante HTTPS
    ports: []

  frontend-staging:
    # Asegura que el backend exista antes de iniciar Nginx (evita "host not found")
    depends_on:
      backend-staging:
        condition: service_started # Si tienes healthcheck en backend, usa: service_healthy
    ports:
      - "8443:443"
    volumes:
      - ./frontend/nginx.https.staging.conf:/etc/nginx/conf.d/default.conf:ro,Z
      - ./certs:/etc/nginx/certs:ro,Z
    # Solo sobreescribimos el ARG para HTTPS; el context/dockerfile vienen del staging base
    build:
      args:
        VITE_API_URL: https://localhost:8443/api
    restart: unless-stopped
