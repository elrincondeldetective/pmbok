# frontend/nginx.https.dev.conf
server {
  listen 443 ssl;
  server_name localhost;

  ssl_certificate     /etc/nginx/certs/dev.crt;
  ssl_certificate_key /etc/nginx/certs/dev.key;

  root /usr/share/nginx/html;
  index index.html;

  # Proxy a la API del backend **con TLS**
  location /api/ {
      proxy_pass https://backend-dev:8444/api/;

      # Encabezados correctos para apps detr√°s de proxy
      proxy_set_header Host              $host;
      proxy_set_header X-Forwarded-Proto https;
      proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;  # <-- CORREGIDO
      proxy_set_header X-Real-IP         $remote_addr;

      # TLS self-signed del upstream (solo DEV)
      proxy_ssl_verify       off;
      proxy_ssl_server_name  off;

      # Timeouts razonables en dev (alineados con gunicorn --timeout 120)
      proxy_connect_timeout 5s;
      proxy_send_timeout    120s;
      proxy_read_timeout    120s;
  }

  location / {
      try_files $uri $uri/ /index.html;
  }
}
