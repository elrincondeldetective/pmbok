# frontend/nginx.https.staging.conf
server {
    listen 443 ssl;
    listen [::]:443 ssl;
    server_name localhost;

    ssl_certificate     /etc/nginx/certs/dev.crt;
    ssl_certificate_key /etc/nginx/certs/dev.key;

    # ⬇️ FALTABA: dónde está el build del frontend
    root /usr/share/nginx/html;
    index index.html;

    # (opcional) logs más verbosos para depurar
    error_log /var/log/nginx/error.log info;

    # Proxy a la API del backend (HTTP interno)
    location /api/ {
        proxy_pass http://backend-staging:8000/api/;

        # Encabezados estándar detrás de proxy
        proxy_set_header Host              $host;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;

        # Timeouts razonables
        proxy_connect_timeout 5s;
        proxy_send_timeout    120s;
        proxy_read_timeout    120s;
    }

    # SPA: servir index.html para rutas de frontend
    location / {
        try_files $uri $uri/ /index.html;
    }
}
