# /webapps/erd-ecosystem/apps/pmbok/frontend/Taskfile.yaml
version: "3"

tasks:
  deps:
    desc: "ğŸ§© Verificar dependencias mÃ­nimas para validaciones"
    cmds:
      - |
        if [ ! -x node_modules/.bin/eslint ] || [ ! -x node_modules/.bin/vite ]; then
          echo "ğŸ“¦ Dependencias faltantes para lint/build. Ejecutando npm ci..."
          npm ci
        else
          echo "âœ… Dependencias frontend listas."
        fi

  install:
    desc: "ğŸ“¦ Instalar dependencias (Local)"
    cmds:
      - npm install

  install-ci:
    desc: "ğŸ“¦ Instalar dependencias (CI - Clean)"
    # npm ci borra node_modules y instala exactamente lo que dice el package-lock.json
    cmds:
      - npm ci

  # âœ… NEW: Tarea de Linting separada
  lint:
    desc: "ğŸ§¹ Validar estilo (ESLint)"
    deps:
      - deps
    cmds:
      - echo "ğŸ§¹ [FRONTEND] Linting..."
      - npm run lint

  # âœ… NEW: Tarea de Build separada
  build:
    desc: "ğŸ§± Validar compilaciÃ³n (Build)"
    deps:
      - deps
    cmds:
      - echo "ğŸ§± [FRONTEND] Building..."
      - npm run build

  test:
    desc: "ğŸ§ª Ejecutar validaciones (Lint + Build)"
    cmds:
      # Como no hay tests unitarios aÃºn, validamos calidad de cÃ³digo y compilaciÃ³n
      - task: lint
      - task: build

  run:
    desc: "ğŸš€ Ejecutar servidor de desarrollo (Vite)"
    cmds:
      - npm run dev
