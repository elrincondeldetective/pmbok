# /webapps/erd-ecosystem/apps/pmbok/docker-compose.staging-frontend-https.yml
services:
  frontend-staging:
    # Ya está con profile "staging" en el base; lo repetimos por claridad
    profiles: ["staging"]

    # Asegura que el backend esté listo antes de iniciar Nginx
    depends_on:
      backend-staging:
        condition: service_healthy

    # Publica Nginx con TLS en el host (puedes cambiar el puerto con FRONTEND_TLS_PORT)
    ports:
      - "${FRONTEND_TLS_PORT:-8443}:443"

    # Nginx con proxy a backend-staging y certificados
    volumes:
      - ./frontend/nginx.https.staging.conf:/etc/nginx/conf.d/default.conf:ro,Z
      - ./certs:/etc/nginx/certs:ro,Z

    # Para que el frontend use el MISMO origen (https://localhost:PORT)/api
    build:
      args:
        VITE_API_URL: "https://localhost:${FRONTEND_TLS_PORT:-8443}/api"

    restart: unless-stopped
